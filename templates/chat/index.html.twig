{% extends 'chatbase.html.twig' %}

{% block title %}Hello ChatController!
{% endblock %}

{% block body %}
	<section class="bg-secondary" style="100vh">
		<div class="container py-5">
			<div class="row d-flex justify-content-center">
				<div class="col-md-10 col-lg-8 col-xl-6">

					<div class="card" id="chat2">
						<div class="card-header d-flex justify-content-between align-items-center p-3">
							<div class="input-group rounded w-75">
								<input type="search" class="form-control rounded heybuddie" placeholder="Search" aria-label="Search" aria-describedby="search-addon"/>
							</div>
							<a href="{{ path('app_blog') }}" class="btn btn-primary btn-sm">
								<i class="fas fa-arrow-left-long"></i>
								Home
							</a>
						</div>
						<div class="card-body" data-mdb-perfect-scrollbar-init style="position: relative; height: 500px;overflow-y: auto;">
							<small class="errrorgoeshere" style="font-size: 10px;"></small>
							<ul class="list-unstyled mb-0 getresult">
								{# am getting all liste of motivator that am following #}
								<!-- loop over all motivators that am following -->
									{% for getmessage in getmessage %}
										<li class="p-2 border-bottom"> <a href="{{ path('app_chat',{'id':getmessage.userone.id}) }}" class="d-flex justify-content-between text-muted" style="text-decoration: none;">
											<div class="d-flex flex-row">
												<div>
													<img src="{{ asset(getmessage.userone.getImagepath) }}" alt="avatar" class="d-flex align-self-center me-3" width="40" height="40" style="object-fit:cover;border-radius:20px;border:2px solid black">
													<span class="badge bg-success badge-dot"></span>
												</div>
												<div class="pt-1">
													<p class="fw-bold mb-0">{{ getmessage.userone.username }}</p>
													<p class="small text-muted">{{ getmessage.content|u.truncate(30, '...', false) }}</p>
												</div>
											</div>
											<div class="pt-1">
												<p class="small text-muted mb-1">{{ getmessage.date|ago }}</p>
												{% if getmessage.status=="unread" %}
													<span class="position-relative p-2 bg-danger border border-light rounded-circle float-end">
														<span class="visually-hidden">New alerts</span>
													</span>

												{% endif %}

											</div>
										</a>
									</li>
								{% else %}
									<div class="px-4 py-5 my-5 text-center beenhere">
										<div class="col-lg-6 mx-auto">
											<p class="mb-4">
												<strong>sorry no message fund</strong>
											</p>
										</div>
									</div>
								{% endfor %}
							</ul>
						</div>

					</div>

				</div>
			</div>

		</div>
	</section>
{% endblock %}
{% block javascripts %} <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	 <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.7/axios.min.js"></script>

	 <script> 
					 $(document).ready(function(){
				  
					 //here we do the seach of motivator that am only following
					  $('.heybuddie').on('keyup', function () {
						let query = $(this).val();
						
						if (query.length > 2) { // Only search if at least 3 characters
							$.ajax({
								url: '{{ path("getmotivator") }}',
								method: 'GET',
								data: { query: query },
								success: function (data) {
									$('.getresult').html(data); 
									$('.errrorgoeshere').html('');               
								}
							});
						}
						else if(query.length ==''){
				            $('.errrorgoeshere').html('');
						}
						else{
						  $('.errrorgoeshere').html('<h3 class="text-danger" style="font-size: 12px;margin-left:0px;">sorry you are not following this motivator</h3>');      
						} 
					  });
				
					  // This is for the chat box when we click we have to see messages for me and particular motivator
					  $('.getmessage').on('click', function (e) {
						e.preventDefault();
						// url that we want to use
						let urls=this.href;
						// this function is to extract the id from  the urls
						function getidfromurl(urls){
							let segment =urls.split("/");
							return segment.pop() || segment.pop();
						}
						// and here is the id extracted from the urls
						let id=getidfromurl(urls);
						$.ajax({
							url:urls,
							type:'POST',
							data:$(this).serialize(),
							success:function(data)
							{
								$('.chatroom').html(data);
							}
						})			
					  })
					 }) 
		</script>
	<!-- Bootstrap core JavaScript -->
{% endblock %}
